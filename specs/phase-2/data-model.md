# Phase II Data Model

**Date**: 2026-01-03
**Feature**: Phase II Full-Stack Web Application
**Spec**: [specs/phase-2/spec.md](./spec.md)

## Overview

This document defines the data model for the Phase II Full-Stack Todo Application. The model supports multi-user functionality with authentication, user isolation, and all Basic + Intermediate features as specified in the requirements.

## Entity: User

**Description**: Represents a registered user in the system with authentication capabilities.

### Fields
- `id` (Integer, Primary Key, Auto-increment)
  - Unique identifier for the user
  - Auto-generated by the database
  - Indexed by default (primary key)

- `email` (String, Unique, Indexed, Max 255 chars)
  - User's email address for login
  - Must be unique across all users
  - Used for authentication
  - Validated as email format (Pydantic EmailStr)

- `hashed_password` (String, 60 chars)
  - Bcrypt-hashed password (12+ rounds)
  - Never stored in plain text
  - Used for authentication verification

- `name` (String, Max 255 chars)
  - User's display name
  - Optional field for personalization

- `is_active` (Boolean, Default: true)
  - Indicates if the user account is active
  - Used for soft account deactivation
  - Prevents login when false

- `created_at` (DateTime, UTC, Auto-generated)
  - Timestamp when the user account was created
  - Automatically set by the database

- `updated_at` (DateTime, UTC, Auto-generated)
  - Timestamp when the user account was last updated
  - Automatically updated by the database

### Relationships
- One-to-many with Todo entity (cascade delete: when user is deleted, all their todos are deleted)

### Validation Rules
- `email`: Must be a valid email format (Pydantic EmailStr), unique constraint enforced
- `hashed_password`: Must be bcrypt hash (60 chars), never plain text
- `name`: Optional, max 255 characters
- `is_active`: Boolean with default true

### Indexes
- Primary key: `id`
- Unique index: `email` (for fast lookups and uniqueness enforcement)
- Regular index: `created_at` (for user registration analytics)

## Entity: Todo

**Description**: Represents a todo item owned by a specific user with priority, tags, and completion status.

### Fields
- `id` (Integer, Primary Key, Auto-increment)
  - Unique identifier for the todo item
  - Auto-generated by the database
  - Indexed by default (primary key)

- `user_id` (Integer, Foreign Key, Indexed, NOT NULL)
  - References the user who owns this todo
  - Enforces user isolation (users can only access their own todos)
  - Cascade delete when user is removed

- `title` (String, 1-500 chars, Required, Indexed)
  - Title of the todo item
  - Required field (cannot be empty)
  - Indexed for search functionality

- `description` (Text, Optional, Max 5000 chars)
  - Detailed description of the todo item
  - Optional field for additional information

- `completed` (Boolean, Default: false, Indexed)
  - Indicates if the todo item is completed
  - Default is false (incomplete)
  - Indexed for filtering by completion status

- `priority` (Enum: 'low', 'medium', 'high', Default: 'medium', Indexed)
  - Priority level of the todo item
  - Default is 'medium'
  - Indexed for filtering and sorting by priority

- `tags` (JSON array of strings, Default: [], Max 10 tags)
  - Array of tags associated with the todo item
  - JSONB field in PostgreSQL for efficient querying
  - Maximum 10 tags per todo

- `created_at` (DateTime, UTC, Auto-generated, Indexed)
  - Timestamp when the todo item was created
  - Automatically set by the database
  - Indexed for sorting by creation date

- `updated_at` (DateTime, UTC, Auto-generated)
  - Timestamp when the todo item was last updated
  - Automatically updated by the database

### Relationships
- Many-to-one with User entity (foreign key: user_id)
- User owns multiple todos (one-to-many)

### Validation Rules
- `user_id`: Must reference an existing user, NOT NULL constraint
- `title`: Required (1-500 chars), trimmed of whitespace, non-empty
- `description`: Optional (max 5000 chars)
- `completed`: Boolean with default false
- `priority`: Enum value ('low', 'medium', 'high') with default 'medium'
- `tags`: JSON array with max 10 strings, each tag max 50 chars
- `created_at`: Auto-generated, UTC timezone
- `updated_at`: Auto-generated, UTC timezone

### Indexes
- Primary key: `id`
- Foreign key index: `user_id` (for user isolation queries)
- Regular indexes: `completed`, `priority`, `created_at`, `title`
- Composite index: (`user_id`, `completed`) for efficient user todo queries with completion filtering
- GIN index on `tags` (JSONB) for efficient tag-based queries

### State Transitions
- `completed`: false → true (when marking as complete)
- `completed`: true → false (when marking as incomplete)
- `priority`: 'low' → 'medium' → 'high' (and any combination) during updates
- `updated_at`: Automatically updated on any field change

## Constraints & Business Rules

### User Isolation
- All queries must filter by `user_id` to enforce user isolation
- Users can only access, modify, or delete their own todos
- Backend API must automatically filter by current_user.id

### Data Integrity
- Foreign key constraint: `user_id` references `users.id`
- NOT NULL constraints on required fields
- Unique constraint on `email` in User entity
- Check constraints for enum values

### Performance
- Indexes on frequently queried fields: `user_id`, `completed`, `priority`, `created_at`, `title`
- Proper indexing to support search, filter, and sort operations
- JSONB indexing for efficient tag queries

## API Integration Points

### Authentication
- JWT tokens contain user_id for efficient authorization
- All todo operations require valid JWT with user_id
- User ID automatically attached to new todos

### Validation
- Frontend validation mirrors backend validation
- Error responses follow consistent format
- Input sanitization at API boundaries

## Future Considerations

### Potential Extensions
- Additional fields: due_date, category, parent_todo (for subtasks)
- Soft delete instead of hard delete: `deleted_at` timestamp
- Sharing mechanism: many-to-many relationship for collaborative todos
- Attachments: separate table for file attachments

### Scalability
- Partitioning strategy for large todo volumes
- Read replicas for read-heavy operations
- Caching layer for frequently accessed data

---

**Version**: 1.0
**Last Updated**: 2026-01-03