# Implementation Plan: Enhanced Todo In-Memory Python Console App

**Branch**: `002-enhanced-todo-features` | **Date**: 2025-12-31 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-enhanced-todo-features/spec.md`

## Summary

Implement an enhanced Phase I Todo console application with all 5 Basic Level features (CRUD operations) PLUS 3 Bonus Intermediate Level features (Priorities & Tags, Search & Filter, Sort Tasks) using a clean three-layer architecture (Model-Service-UI). The application uses Python 3.13+, UV package manager, in-memory dataclass storage, and the rich library for professional table output with color-coded priorities. Code generation leverages the `hackathon-cli-builder` reusable subagent for +200 Reusable Intelligence bonus points.

**Technical Approach**:
- **Model Layer** (`models.py`): Task dataclass with priority enum and tags list
- **Service Layer** (`services.py`): TodoService class with CRUD + search/filter/sort methods
- **UI Layer** (`cli.py`): Interactive CLI with rich.Table display and comprehensive input validation

---

## Technical Context

**Language/Version**: Python 3.13+
**Primary Dependencies**: rich (‚â•13.0.0) for table display
**Storage**: In-memory list of Task dataclass instances (no persistence)
**Testing**: pytest with pytest-cov (minimum 80% coverage)
**Target Platform**: Cross-platform CLI (Windows WSL 2, macOS, Linux)
**Project Type**: Single console application
**Performance Goals**: <1 second for all operations, handles 1000+ tasks
**Constraints**: In-memory only (no files/database), CLI only (no GUI/web), Phase I tech stack only
**Scale/Scope**: 9 menu options, 45 functional requirements, 3 source files + tests

---

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Article I: Spec-Driven Development
- ‚úÖ **PASS**: All code generated by `hackathon-cli-builder` subagent from refined spec
- ‚úÖ **PASS**: Specification complete and validated (no clarifications needed)
- ‚úÖ **PASS**: Plan links to spec sections and task IDs

### Article II: Agentic Workflow
- ‚úÖ **PASS**: Following Specify ‚Üí Plan ‚Üí Tasks ‚Üí Implement sequence
- ‚úÖ **PASS**: Using Spec-Kit Plus commands (`/sp.specify`, `/sp.plan`, `/sp.tasks`, `/sp.implement`)

### Article III: Phase-Based Evolution
- ‚úÖ **PASS**: Phase I constraints honored (in-memory, CLI, Python, pytest)
- ‚úÖ **PASS**: Intermediate features marked as bonus (+200 points)
- ‚úÖ **PASS**: Organized in `specs/002-enhanced-todo-features/` directory

### Article IV: Technology Stack Constraints
- ‚úÖ **PASS**: Python 3.13+ only
- ‚úÖ **PASS**: UV package manager
- ‚úÖ **PASS**: In-memory storage (list of dataclasses)
- ‚úÖ **PASS**: CLI interface (no web/GUI)
- ‚úÖ **PASS**: pytest for testing
- ‚úÖ **PASS**: Claude Code for generation
- ‚ö†Ô∏è **DEVIATION (JUSTIFIED)**: Added rich library for professional table output (bonus feature, graceful fallback if missing)

### Article V: Feature Progression
- ‚úÖ **PASS**: All 5 Basic Level features included (Add, Delete, Update, View, Mark Complete)
- ‚úÖ **PASS**: 3 Intermediate Level features as bonus (Priorities & Tags, Search & Filter, Sort)
- ‚úÖ **PASS**: No Advanced Level features (those are Phase III+)

### Article VI: Code Quality Standards
- ‚úÖ **PASS**: PEP 8 compliance (enforced by ruff)
- ‚úÖ **PASS**: Type hints required on all functions
- ‚úÖ **PASS**: Google-style docstrings required
- ‚úÖ **PASS**: Minimum 80% test coverage
- ‚úÖ **PASS**: Clean architecture (Model-Service-UI layers)
- ‚úÖ **PASS**: Single Responsibility Principle

### Article VII: Security & Safety
- ‚úÖ **PASS**: Input validation at CLI layer (title, ID, priority, tags)
- ‚úÖ **PASS**: No code execution from user input (no eval/exec)
- ‚úÖ **PASS**: Clear error messages without implementation details
- ‚úÖ **PASS**: No external network calls or file system access

### Article VIII: Documentation Excellence
- ‚úÖ **PASS**: README.md with setup and usage instructions planned
- ‚úÖ **PASS**: CLAUDE.md with agent instructions planned
- ‚úÖ **PASS**: Code comments linking to spec sections planned

### Article X: Reusable Intelligence
- ‚úÖ **PASS**: `hackathon-cli-builder` subagent committed to `.claude/agents/`
- ‚úÖ **PASS**: PHRs recorded in `history/prompts/002-enhanced-todo-features/`
- ‚úÖ **PASS**: Demonstrates +200 bonus points for Reusable Intelligence

**Gate Status**: ‚úÖ **ALL GATES PASS** - Proceed to Phase 0

---

## Project Structure

### Documentation (this feature)

```text
specs/002-enhanced-todo-features/
‚îú‚îÄ‚îÄ spec.md              # Comprehensive requirements (45 FRs, 7 user stories)
‚îú‚îÄ‚îÄ plan.md              # This file (architectural design)
‚îú‚îÄ‚îÄ tasks.md             # Atomic task breakdown (generated by /sp.tasks)
‚îî‚îÄ‚îÄ checklists/
    ‚îî‚îÄ‚îÄ requirements.md  # Spec quality validation
```

### Source Code (repository root)

```text
phase1-console/
‚îú‚îÄ‚îÄ .claude/
‚îÇ   ‚îî‚îÄ‚îÄ agents/
‚îÇ       ‚îú‚îÄ‚îÄ hackathon-cli-builder.md        # Reusable Intelligence (+200 pts)
‚îÇ       ‚îú‚îÄ‚îÄ hackathon-test-generator.md     # Test generation
‚îÇ       ‚îú‚îÄ‚îÄ hackathon-spec-refiner.md       # Spec refinement
‚îÇ       ‚îî‚îÄ‚îÄ hackathon-setup-assistant.md    # Project setup
‚îÇ
‚îú‚îÄ‚îÄ .specify/
‚îÇ   ‚îú‚îÄ‚îÄ memory/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constitution.md                 # Project constitution
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ powershell/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ setup-plan.ps1
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ create-new-feature.ps1
‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ       ‚îú‚îÄ‚îÄ spec-template.md
‚îÇ       ‚îú‚îÄ‚îÄ plan-template.md
‚îÇ       ‚îî‚îÄ‚îÄ tasks-template.md
‚îÇ
‚îú‚îÄ‚îÄ history/
‚îÇ   ‚îî‚îÄ‚îÄ prompts/
‚îÇ       ‚îî‚îÄ‚îÄ 002-enhanced-todo-features/
‚îÇ           ‚îú‚îÄ‚îÄ 001-enhanced-todo-features-spec.spec.prompt.md
‚îÇ           ‚îî‚îÄ‚îÄ 002-enhanced-todo-plan.plan.prompt.md
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ todo_app/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py          # Package marker
‚îÇ       ‚îú‚îÄ‚îÄ models.py            # Task dataclass + Priority enum
‚îÇ       ‚îú‚îÄ‚îÄ services.py          # TodoService (CRUD + search/filter/sort)
‚îÇ       ‚îú‚îÄ‚îÄ cli.py               # CLI UI with rich.Table
‚îÇ       ‚îî‚îÄ‚îÄ __main__.py          # Entry point (python -m src.todo_app)
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_models.py           # Test Task & Priority
‚îÇ   ‚îú‚îÄ‚îÄ test_services.py         # Test TodoService methods
‚îÇ   ‚îî‚îÄ‚îÄ test_cli.py              # Test CLI functions
‚îÇ
‚îú‚îÄ‚îÄ pyproject.toml               # UV config + rich dependency
‚îú‚îÄ‚îÄ README.md                    # User documentation
‚îú‚îÄ‚îÄ CLAUDE.md                    # AI agent instructions
‚îî‚îÄ‚îÄ .gitignore
```

**Structure Decision**: Single project structure chosen because this is a standalone console application with no separate frontend/backend. All code lives in `src/todo_app/` following Python package conventions. Tests mirror source structure in `tests/`.

---

## High-Level Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     USER (Console)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  CLI LAYER (cli.py)                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  main() - Main loop                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  display_tasks_rich() - Rich table with color coding ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Menu options 1-9:                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    1. Add Task      6. Search Tasks                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    2. View All      7. Filter Tasks                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    3. Update Task   8. Sort Tasks                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    4. Delete Task   9. Exit                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    5. Mark Complete                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Input validation helpers                             ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SERVICE LAYER (services.py)                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  class TodoService:                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  CRUD Methods:                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    add_task(title, desc, priority, tags) ‚Üí Task     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    get_all_tasks() ‚Üí list[Task]                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    get_task_by_id(id) ‚Üí Task | None                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    update_task(id, **kwargs) ‚Üí bool                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    delete_task(id) ‚Üí bool                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    mark_task_complete(id) ‚Üí bool                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Search/Filter/Sort Methods:                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    search_tasks(keyword) ‚Üí list[Task]               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    filter_by_status/priority/tag(...) ‚Üí list[Task]  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    sort_by_priority/title/id(...) ‚Üí list[Task]      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DATA LAYER (models.py)                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  class Priority(Enum):                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      HIGH = "high"                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      MEDIUM = "medium"                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      LOW = "low"                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  @dataclass                                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  class Task:                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      id: int                                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      title: str                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      description: str = ""                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      completed: bool = False                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      priority: Priority = Priority.MEDIUM             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      tags: list[str] = field(default_factory=list)   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Storage: In-memory list[Task] in TodoService        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Component Details

### models.py - Data Layer

**Responsibilities**:
- Define Task entity as dataclass with type safety
- Define Priority enum with comparison support
- Provide helper methods for search/filter logic

**Key Classes**:

```python
class Priority(Enum):
    """Task priority levels with sorting support."""
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"

    def __lt__(self, other: "Priority") -> bool:
        """Enable HIGH < MEDIUM < LOW for sorting."""
        order = {Priority.HIGH: 0, Priority.MEDIUM: 1, Priority.LOW: 2}
        return order[self] < order[other]

@dataclass
class Task:
    """Task entity with all attributes."""
    id: int
    title: str
    description: str = ""
    completed: bool = False
    priority: Priority = Priority.MEDIUM
    tags: list[str] = field(default_factory=list)

    def matches_keyword(self, keyword: str) -> bool:
        """Case-insensitive search in title/description."""
        keyword_lower = keyword.lower()
        return (keyword_lower in self.title.lower() or
                keyword_lower in self.description.lower())

    def has_tag(self, tag: str) -> bool:
        """Case-insensitive tag matching."""
        return tag.lower() in [t.lower() for t in self.tags]
```

**Design Decisions**:
- Dataclass over dict for type safety and IDE support
- Priority enum prevents invalid values
- Helper methods encapsulate search logic
- Field defaults prevent mutable default arguments

---

### services.py - Service Layer

**Responsibilities**:
- Manage in-memory task storage (list of Task instances)
- Provide CRUD operations with validation
- Provide search, filter, and sort operations
- Auto-generate sequential task IDs

**Key Methods**:

| **Method** | **Purpose** | **Spec Reference** |
|------------|-------------|--------------------|
| `add_task(...)` | Create new task with validation | FR-001, FR-007, FR-019, FR-020, FR-023 |
| `get_all_tasks()` | Retrieve all tasks | FR-003 |
| `get_task_by_id(id)` | Retrieve single task | FR-008 |
| `update_task(id, ...)` | Update task attributes | FR-005, FR-021 |
| `delete_task(id)` | Remove task | FR-004 |
| `mark_task_complete(id)` | Toggle completion status | FR-006 |
| `search_tasks(keyword)` | Search by keyword | FR-028, FR-029 |
| `filter_by_status(completed)` | Filter by status | FR-032 |
| `filter_by_priority(priority)` | Filter by priority | FR-033 |
| `filter_by_tag(tag)` | Filter by tag | FR-034 |
| `sort_by_priority(tasks)` | Sort HIGH‚ÜíMEDIUM‚ÜíLOW | FR-037 |
| `sort_by_title(tasks)` | Sort A-Z alphabetically | FR-038 |
| `sort_by_id(tasks)` | Sort by creation order | FR-039 |

**Design Decisions**:
- Private `_tasks` list prevents external mutation
- Private `_next_id` counter ensures unique IDs
- Methods return Task, bool, or Optional[Task] for clarity
- Search/filter/sort are pure functions (no side effects)

---

### cli.py - UI Layer

**Responsibilities**:
- Display interactive menu with 9 options
- Render tasks in rich.Table format with color coding
- Validate all user input with clear error messages
- Orchestrate calls to TodoService

**Key Functions**:

| **Function** | **Purpose** | **Spec Reference** |
|--------------|-------------|--------------------|
| `main()` | Main loop and menu display | FR-010, FR-045 |
| `display_tasks_rich(tasks)` | Rich table with colors | FR-003, FR-041, FR-043 |
| `add_task_ui(service)` | Interactive add task | FR-001, FR-019, FR-023 |
| `view_tasks_ui(service)` | Display all tasks | FR-003 |
| `update_task_ui(service)` | Interactive update | FR-005, FR-021 |
| `delete_task_ui(service)` | Interactive delete | FR-004 |
| `mark_complete_ui(service)` | Toggle status | FR-006 |
| `search_tasks_ui(service)` | Interactive search | FR-028, FR-030 |
| `filter_tasks_ui(service)` | Interactive filter | FR-032-036 |
| `sort_tasks_ui(service)` | Interactive sort | FR-037-040 |
| `get_priority_input()` | Validate priority 1-3 | FR-021 |
| `get_tags_input()` | Parse comma-separated tags | FR-024 |
| `get_non_empty_string(prompt)` | Validate non-empty | FR-007 |
| `get_task_id()` | Validate positive int | FR-008 |

**Design Decisions**:
- Rich library for professional table output
- Graceful fallback if rich not installed
- Input validation loops until valid
- Clear error messages with emoji indicators
- Menu grouped into sections for clarity

---

## Data Flow Examples

### Add Task with Priority and Tags

```
User Input:
  Menu choice: 1
  Title: "Fix production bug"
  Description: "Critical issue in payment flow"
  Priority: 1 (HIGH)
  Tags: "work, urgent, backend"

Flow:
  cli.py: add_task_ui(service)
    ‚Üì get_non_empty_string("Title: ")
    ‚Üì input("Description: ")
    ‚Üì get_priority_input() ‚Üí Priority.HIGH
    ‚Üì get_tags_input() ‚Üí ["work", "urgent", "backend"]
    ‚Üì
  services.py: service.add_task(title, desc, priority, tags)
    ‚Üì Validate title non-empty
    ‚Üì Create Task(id=1, title="...", priority=HIGH, tags=[...])
    ‚Üì Append to _tasks list
    ‚Üì Increment _next_id to 2
    ‚Üì Return Task instance
    ‚Üì
  cli.py: Display success message
    "‚úÖ Task added successfully! (ID: 1)"
    Show task details with color-coded priority
```

### Search and Display Results

```
User Input:
  Menu choice: 6
  Keyword: "meeting"

Flow:
  cli.py: search_tasks_ui(service)
    ‚Üì Get keyword from user
    ‚Üì
  services.py: results = service.search_tasks("meeting")
    ‚Üì For each task in _tasks:
    ‚Üì   if task.matches_keyword("meeting"):
    ‚Üì     add to results
    ‚Üì Return filtered list
    ‚Üì
  models.py: task.matches_keyword("meeting")
    ‚Üì Check if "meeting" in title.lower()
    ‚Üì OR "meeting" in description.lower()
    ‚Üì Return True/False
    ‚Üì
  cli.py: display_tasks_rich(results)
    ‚Üì Create Rich Table
    ‚Üì Add "Total Tasks: N" header
    ‚Üì Add color-coded rows
    ‚Üì Print to console
```

---

## Error Handling Strategy

### Input Validation Matrix

| **Input** | **Validation** | **Error Handling** |
|-----------|----------------|-------------------|
| Menu choice | 1-9 integer | Loop until valid, show "‚ùå Error: Please enter 1-9" |
| Task ID | Positive integer | Loop until valid number, show "‚ùå Error: ID must be positive" |
| Title | Non-empty string | Loop until non-empty, show "‚ùå Error: Title required" |
| Priority | 1-3 or Enter | Loop until valid, default to MEDIUM if Enter |
| Tags | Comma-separated | Parse and trim, accept empty |
| Keyword | Any string | Accept empty (cancel operation) |

### Error Message Examples

```python
# ‚úÖ GOOD: Clear, actionable
"‚ùå Error: Task ID must be a positive number"
"‚ùå Error: Title is required and cannot be empty"
"‚ùå Error: Please enter 1, 2, or 3"
"üìã No tasks found matching 'xyz'"

# ‚ùå BAD: Vague or technical
"Error: Invalid input"
"ValueError exception"
"None returned"
```

### Graceful Degradation

```python
# Rich library fallback
try:
    from rich.console import Console
    from rich.table import Table
    RICH_AVAILABLE = True
except ImportError:
    RICH_AVAILABLE = False
    print("‚ö†Ô∏è 'rich' not installed. Using basic format.")
    print("Install with: uv add rich\n")
```

---

## Testing Strategy

### Coverage Goals

| **File** | **Target** | **Test Types** |
|----------|-----------|----------------|
| models.py | 90%+ | Unit tests for Task, Priority, helpers |
| services.py | 85%+ | Unit tests for all methods |
| cli.py | 75%+ | Integration tests with mocked input |
| **Overall** | **80%+** | Combined coverage |

### Key Test Cases

**models.py**:
- Task creation with defaults
- Priority enum comparison (HIGH < MEDIUM < LOW)
- `matches_keyword()` case-insensitive search
- `has_tag()` case-insensitive matching

**services.py**:
- Add task with all attributes
- Add task with empty title raises ValueError
- Get all tasks returns copy
- Update task with partial fields
- Delete task removes from list
- Mark complete toggles status
- Search finds matches in title and description
- Filter by status/priority/tag
- Sort by priority/title/ID

**cli.py**:
- `get_priority_input()` with valid/invalid input
- `get_tags_input()` parses comma-separated
- `get_non_empty_string()` rejects empty
- Display tasks with rich table (mock Console)

### Test Execution

```bash
uv run pytest --cov=src/todo_app --cov-report=html
# Expected: 80%+ coverage across all files
```

---

## Implementation Phases

### Phase 0: Project Setup
1. Initialize UV project with Python 3.13+
2. Add rich library to pyproject.toml
3. Create directory structure
4. Commit `.claude/agents/hackathon-cli-builder.md`

### Phase 1: Model Layer
1. Implement Priority enum with `__lt__`
2. Implement Task dataclass
3. Implement helper methods
4. Write unit tests

### Phase 2: Service Layer
1. Implement TodoService `__init__`
2. Implement CRUD methods
3. Implement search/filter/sort methods
4. Write comprehensive unit tests

### Phase 3: UI Layer
1. Implement rich table display
2. Implement input validation helpers
3. Implement menu and routing
4. Implement all UI functions
5. Write integration tests

### Phase 4: Integration
1. Run full test suite
2. Manual testing of all features
3. Fix bugs and edge cases
4. Verify 80%+ coverage

### Phase 5: Documentation & Submission
1. Write README.md
2. Write CLAUDE.md
3. Create demo video
4. Commit to main branch
5. Tag v1.0-phase1-enhanced
6. Submit to hackathon

---

## Reusable Intelligence: hackathon-cli-builder

**Purpose**: Generate professional three-layer CLI applications

**Capabilities**:
- Model layer with dataclasses and enums
- Service layer with CRUD + advanced operations
- UI layer with rich tables and validation

**Usage**:
```bash
/implement --agent hackathon-cli-builder
```

**Bonus**: +200 points for Reusable Intelligence

**Evidence**:
- Committed to `.claude/agents/hackathon-cli-builder.md`
- PHRs in `history/prompts/002-enhanced-todo-features/`
- Documented in README

---

## Acceptance Criteria

This plan is accepted when:

1. ‚úÖ All 45 functional requirements architecturally addressed
2. ‚úÖ Three-layer architecture clearly defined
3. ‚úÖ All 7 user stories have implementation strategy
4. ‚úÖ Testing strategy covers 80%+ with specific cases
5. ‚úÖ Error handling for 12+ edge cases defined
6. ‚úÖ Rich library integration with fallback
7. ‚úÖ Reusable Intelligence documented
8. ‚úÖ Constitution compliance verified
9. ‚úÖ Data flow diagrams provided
10. ‚úÖ Implementation phases outlined

---

## Next Steps

1. **Review & Approve**: Stakeholder review this plan
2. **Run `/sp.tasks`**: Generate atomic task breakdown
3. **Run `/sp.implement`**: Invoke `hackathon-cli-builder`
4. **Execute**: Follow implementation phases
5. **Test**: Achieve 80%+ coverage
6. **Document**: Write README and CLAUDE.md
7. **Demo**: Record 90-second video
8. **Submit**: Commit, tag, and submit

**Estimated Effort**: 8-12 hours

---

**Plan Status**: ‚úÖ Complete - Ready for `/sp.tasks`
